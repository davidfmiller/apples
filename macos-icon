#!/bin/sh

# https://github.com/davidfmiller/bin/

if [[ "`which sips`" = "" ]]
then 
  >&2 echo "ğŸš«  OS X only"
  exit 1
fi

if [[ "$1" = "" ]]
then
  >&2 echo "ğŸš«  No icon file provided"
  exit 1
fi


if [ ! -e "$1" ]
then
  >&2 echo "ğŸš«  Invalid icon provided"
  exit 1
fi

filename=$(basename "$1")
extension="${filename##*.}"
target="$HOME/Desktop/${filename%.*}.iconset"

if [ -d "$target" ]
then
  echo "ğŸš«  Destination folder '$target' already exists"
  exit 1
fi

mkdir "$target"

sips -Z 1024 "$1" --out "$target/icon_512x512@2x.${extension}"
sips -Z 512 "$1" --out "$target/icon_512x512.${extension}"
sips -Z 512 "$1" --out "$target/icon_256x256@2x.${extension}"
sips -Z 256 "$1" --out "$target/icon_256x256.${extension}"
sips -Z 256 "$1" --out "$target/icon_128x128@2x.${extension}"
sips -Z 128 "$1" --out "$target/icon_128x128.${extension}"
sips -Z 64 "$1" --out "$target/icon_32x32@2x.${extension}"
sips -Z 32 "$1" --out "$target/icon_32x32.${extension}"
sips -Z 32 "$1" --out "$target/icon_16x16@2x.${extension}"
sips -Z 16 "$1" --out "$target/icon_16x16.${extension}"

#echo "# macos-application-icon\n\nGenerated by [macos-application-icon](https://github.com/davidfmiller/bin/)" > "$target/readme.md"

iconutil -c icns "$target"

#rm -R $target
open -R "$target"