#!/usr/bin/swift

import Darwin
import Foundation
import Cocoa

let stdout = FileHandle.standardOutput
let stderr = FileHandle.standardError

var success : Bool = false

if CommandLine.argc == 1 {
  stderr.write("ðŸš« Invalid usage: exif [filenames]\n".data(using: String.Encoding.utf8, allowLossyConversion : false)!)
  exit(1)
}

let args = CommandLine.arguments[1 ..< CommandLine.arguments.count]

var count : Int = 0
for i in args {

  if args.count > 1 {
    stdout.write("\(count > 0 ? "\n" : "")ðŸ–¼  \(i)\n".data(using: String.Encoding.utf8, allowLossyConversion : false)!)
  }

  let url : URL = NSURL.fileURL(withPath: "\(i)", isDirectory: false) 
    if let imageSource = CGImageSourceCreateWithURL(url as CFURL, nil) {
      if let tags = CGImageSourceCopyPropertiesAtIndex(imageSource, 0, nil) {
        success = true
        stdout.write("\(tags)\n".data(using: String.Encoding.utf8, allowLossyConversion : false)!)
      }
    } else {
      stderr.write("ðŸš« No exif data for \(i)\n".data(using: String.Encoding.utf8, allowLossyConversion : false)!)
    }

    count += 1
}

exit(0)
